CREATE TABLE DEVELOPER(ID_DEVELOPER INTEGER, NOMBRE VARCHAR2(120),EMAIL VARCHAR2(120),CONSTRAINT PK_ID_DEVELOPER PRIMARY KEY(ID_DEVELOPER));

CREATE TABLE TAREA(ID_TAREA INTEGER,ID_DEVELOPER INTEGER,DESCRIPCION VARCHAR2(500),COMPLETADA CHAR,PORCIENTO_COMPLETADA INTEGER,FECHA DATE, CONSTRAINT PK_ID_TAREA PRIMARY KEY(ID_TAREA),CONSTRAINT FK_ID_DEVELOPER FOREIGN KEY(ID_DEVELOPER)REFERENCES DEVELOPER(ID_DEVELOPER));

CREATE SEQUENCE SECUENCIA_DEVELOPER
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE SEQUENCE SECUENCIA_TAREA
START WITH 1
INCREMENT BY 1
NOMAXVALUE;

CREATE OR REPLACE PROCEDURE GUARDAR_DEVELOPER(MY_ID_DEVELOPER OUT INTEGER,MY_NOMBRE IN VARCHAR2,MY_EMAIL IN VARCHAR2)
AS
BEGIN
SELECT SECUENCIA_DEVELOPER.NEXTVAL INTO MY_ID_DEVELOPER FROM DUAL;
INSERT INTO DEVELOPER VALUES(MY_ID_DEVELOPER,MY_NOMBRE,MY_EMAIL);
END;
/

CREATE OR REPLACE PROCEDURE GUARDAR_TAREA(MY_ID_TAREA OUT INTEGER,MY_ID_DEVELOPER IN INTEGER,MY_DESCRIPCION IN VARCHAR2)
AS
BEGIN
SELECT SECUENCIA_DEVELOPER.NEXTVAL INTO MY_ID_TAREA FROM DUAL;
INSERT INTO TAREA VALUES(MY_ID_TAREA,MY_ID_DEVELOPER,MY_DESCRIPCION,'N',0,SYSDATE);
END;
/

DECLARE
VALOR INTEGER;
BEGIN
GUARDAR_DEVELOPER(VALOR,'BRENDA','BRENDA@GMAIL.COM');
GUARDAR_TAREA(ID_TAREA, ID_DEVELOPER, 'CREACION DE LA PAGINA WEB');
GUARDAR_DEVELOPER(VALOR,'JOSE OMAR','OMAR@YAHOO.COM');
GUARDAR_TAREA(ID_TAREA, ID_DEVELOPER, 'CREACION DE LAS TABLAS');
GUARDAR_DEVELOPER(VALOR,'VICTOR ANGEL','VICTOR@HOTMAIL.COM');
GUARDAR_TAREA(ID_TAREA, ID_DEVELOPER, 'PROGRAMACION DE PROCEDIMIENTOS');
GUARDAR_DEVELOPER(VALOR,'LESLYE','LESLIE@LIVE.COM');
GUARDAR_TAREA(ID_TAREA, ID_DEVELOPER, 'PROGRAMACION DE SERVICIOS WEB');
DBMS_OUTPUT.PUT_LINE('REGISTRO GUARDADO CON ID: '||VALOR);
END;
/



SELECT * FROM DEVELOPER;
SELECT * FROM TAREA;


CREATE OR REPLACE PROCEDURE ACTUALIZAR_TAREA(MY_ID_TAREA IN INTEGER, MY_ID_DEVELOPER IN INTEGER, MY_PORCIENTO_COMPLETADA IN INTEGER)
AS
PORCENTAJE_ACTUAL INTEGER;
PORCENTAJE_TOTAL INTEGER;
BEGIN
SELECT PORCIENTO_COMPLETADA INTO PORCENTAJE_ACTUAL FROM TAREA WHERE ID_TAREA=MY_ID_TAREA;
PORCENTAJE_TOTAL := PORCENTAJE_ACTUAL + MY_PORCIENTO_COMPLETADA;

IF PORCENTAJE_TOTAL > 100 THEN
RAISE_APPLICATION_ERROR(-20005, 'LO SIENTO EL PORCENTAGE ES > A 100%');
END IF;
IF PORCENTAJE_TOTAL = 100 THEN
UPDATE TAREA SET PORCIENTO_COMPLETADA=100, COMPLETADA='S',FECHA=SYSDATE WHERE ID_TAREA=MY_ID_TAREA;
END IF;
UPDATE TAREA SET PORCIENTO_COMPLETADA=PORCENTAJE_TOTAL, FECHA=SYSDATE WHERE ID_TAREA=MY_ID_TAREA;
END;

BEGIN
ACTUALIZAR_TAREA(1, 1, 30);
END;

BEGIN
ACTUALIZAR_TAREA(1, 1, 40);
END;

SELECT * FROM TAREA;
BEGIN
ACTUALIZAR_TAREA(2, 2, 40);
END;

BEGIN
ACTUALIZAR_TAREA(2, 2, 70);
END;

BEGIN
ACTUALIZAR_TAREA(2, 2, 60);
END;




DROP PROCEDURE GUARDAR_PROCEDIMIENTO;
DROP PROCEDURE GUARDAR_DEVELOPER;
DROP TABLE DEVELOPER;
DROP TABLE TAREA;
DROP SEQUENCE SECUENCIA_DEVELOPER;
DROP SEQUENCE SECUENCIA_TAREA;
DROP PROCEDURE GUARDAR_TAREA;
